<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Game Drag & Drop + Mengepel</title>

<style>
/* ================= GLOBAL ================= */
body, html { margin:0; padding:0; overflow:hidden; font-family:Arial, sans-serif; background:#fff; }

/* Background */
#bgRoom { position:fixed; right:0; bottom:0; min-width:100%; min-height:100%; z-index:-1; object-fit:cover; }

/* Overlay */
#overlay {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.4); opacity:0; pointer-events:none;
    transition:opacity 0.25s ease;
    z-index:98; /* ↑ dinaikkan dari 5 → 98 */
}
#overlay.active { opacity:1; pointer-events:auto; }

/* Tombol Setting */
#settingBtnImg {
    position:fixed;
    top:20px;
    right:20px;
    width:150px;
    cursor:pointer;
    z-index:20;
    transition: transform 0.25s ease, filter 0.25s ease;
}
#settingBtnImg:hover {
    transform: scale(1.12);
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.6));
}

/* PANEL SETTING */
#settingPanel {
    position:absolute;
    top:50%; left:50%;
    width:320px;
    transform:translate(-50%,-50%) scale(0.7);
    background:rgba(255,255,255,0.85);
    padding:20px; border-radius:15px; color:#000;
    opacity:0; pointer-events:none;
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
    transition:opacity 0.25s ease, transform 0.25s ease;
    text-align:center;
    z-index:99; /* ↑ dinaikkan dari 10 → 99 (panel paling atas!) */
}
#settingPanel.active {
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:auto;
}

/* Close Panel */
#closeSetting {
    position:absolute; top:10px; right:15px;
    font-size:50px; font-weight:bold; cursor:pointer; 
    color:#333; transition:transform 0.2s, color 0.2s;
}
#closeSetting:hover { transform:scale(1.2); color:red; }

/* Slider Volume */
#volumeSlider { width:100%; height:16px; background:#a8ff8a; border-radius:4px; border:2px solid #6fc36f; }
#volumeSlider::-webkit-slider-thumb {
    -webkit-appearance:none; width:20px; height:20px;
    background:#6fc36f; border:2px solid #4b914b; border-radius:4px;
}

/* Tombol Mute & Home */
#muteInPanelImg, #homeIcon {
    width:150px; cursor:pointer; margin-top:5px;
    transition:transform .2s, filter .2s;
}
#muteInPanelImg:hover, #homeIcon:hover {
    transform:scale(1.1);
    filter:drop-shadow(0 0 8px rgba(0,0,0,0.5));
}

/* Slot gambar */
.slotImg {
    position:absolute; width:100px; height:100px;
    background-size:contain; background-repeat:no-repeat; background-position:center;
}
.slotImg2 {
    position:absolute; width:290px; height:290px;
    background-size:contain; background-repeat:no-repeat; background-position:left;
}

/* Item draggable */
.item { position:absolute; width:100px; cursor:grab; }

/* Sparkle */
.sparkle {
    position:absolute; width:200px; height:200px;
    background:url('https://image2url.com/images/1764159323156-5bc233ee-b37d-44c7-8b1c-9a6e43aa4f01.png') no-repeat center/contain;
    pointer-events:none; z-index:20;
}

/* Hint tangan */
#handHint {
    position:absolute;
    width:150px;
    opacity:0;
    pointer-events:none;
    z-index:15;
    left:0;
    top:0;
}

/* Kotoran */
.dirt {
    position:absolute;
    width:200px;
    display:none;
    z-index:9;
    opacity:1;
    transition: opacity 0.8s ease;
}


/* Orang */
#orangImg { position:absolute; width:350px; display:none; z-index:9; }

/* VIDEO */
#thankVideo {
    display:none; position:fixed; top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    z-index:50;
}

/* ITEM DRAGGABLE UNTUK SLOT3 (PEL) */
#item3Draggable {
    position: absolute;
    width: 15px;
    height: auto;
    cursor: grab;
    z-index: 20;
    user-select: none;
}

</style>
</head>
<body>

<!-- BG -->
<img id="bgRoom" src="https://image2url.com/images/1764173835346-11b8db5b-002f-4749-a785-7b26f0affebc.png">

<!-- Tombol Setting -->
<img id="settingBtnImg" src="https://image2url.com/images/1763954705793-121a2413-8603-4603-9be7-e543e18c3f3a.png">

<!-- Audio -->
<audio id="bgMusic" autoplay loop>
    <source src="https://d.top4top.io/m_3617nutqe1.mp3">
</audio>
<audio id="clickSound"><source src="https://f.top4top.io/m_3615q8in01.mp3"></audio>
<audio id="correctSound"><source src="https://f.top4top.io/m_3615s7i2x1.mp3"></audio>

<div id="overlay"></div>

<!-- PANEL SETTING -->
<div id="settingPanel">
    <span id="closeSetting">×</span>
    <h3>Pengaturan</h3>
    <label>Volume Musik:</label>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">

    <div style="margin-top:15px;">
        <img id="muteInPanelImg" src="https://image2url.com/images/1763955187976-61e3ab1a-0b3b-47c3-8ab0-8f66ccfe1b72.png">
        <img id="homeIcon" src="https://image2url.com/images/1763963926977-0fc775b7-3547-4c49-8fda-22cff486b226.png">
    </div>
</div>

<!-- SLOT -->
<div id="slot1" class="slotImg" style="top:300px; left:950px; background-image:url('https://image2url.com/images/1764158267432-f7d56a00-e887-4a98-85c4-75bb5f71d3e8.png');"></div>
<div id="slot2" class="slotImg" style="top:700px; left:675px; background-image:url('https://image2url.com/images/1764158350143-4065a50e-f902-4e06-abd8-8cae3c16e4dd.png');"></div>
<div id="slot3" class="slotImg2" style="top:525px; left:800px; background-image:url('https://image2url.com/images/1764158823262-9d080faa-493f-43e8-b670-cb6e94e5acf2.png');"></div>
<div id="slot4" class="slotImg" style="top:700px; left:1250px; background-image:url('https://image2url.com/images/1764159409572-cd5e9457-f9c0-461a-83ff-87de3900d30e.png');"></div>
<div id="slot5" class="slotImg" style="top:635px; left:1250px; background-image:url('https://image2url.com/images/1764159460894-cdd34cb3-ca93-4b01-a0b0-cf35bf002061.png');"></div>

<!-- ITEMS -->
<img id="item1" class="item" src="https://image2url.com/images/1764149382323-7523f742-7af6-43cb-9f45-f9795c64fa5f.png" style="top:700px; left:1000px;">
<img id="item2" class="item" src="https://image2url.com/images/1764149310385-a858b653-2f06-47e7-a6ec-38d174a453b6.png" style="top:950px; left:450px;">
<img id="item3" class="item" src="https://image2url.com/images/1764152426729-702a3dc7-5d15-4b9e-8aea-a34f2f46e930.png" style="top:1000px; left:1300px;">
<img id="item4" class="item" src="https://image2url.com/images/1764149187267-4fbc8ab5-ff11-4005-b506-0a707cb20c27.png" style="top:875px; left:1500px;">
<img id="item5" class="item" src="https://image2url.com/images/1764151103918-6d60e593-81fc-4519-b349-a3e1afa12a84.png" style="top:750px; left:1350px;">

<!-- HINT TANGAN -->
<img id="handHint" src="https://image2url.com/images/1764149969330-ad5cdc0c-e6dd-4a77-9755-2da6582cada7.png">

<!-- KOTORAN -->
<!-- KOTORAN: 3 titik -->
<img class="dirt" src="https://image2url.com/images/1764173602992-dd37a4a7-baa8-49d5-87e1-e78ef2f767e9.png" style="top:900px; left:450px;">
<img class="dirt" src="https://image2url.com/images/1764173602992-dd37a4a7-baa8-49d5-87e1-e78ef2f767e9.png" style="top:975px; left:1125px;">
<img class="dirt" src="https://image2url.com/images/1764173602992-dd37a4a7-baa8-49d5-87e1-e78ef2f767e9.png" style="top:775px; left:1400px;">


<!-- ORANG -->
<img id="orangImg" src="https://image2url.com/images/1765000000001-orang.png" style="top:250px; left:300px;">

<!-- VIDEO -->
<video id="thankVideo">
    <source src="https://image2url.com/videos/1764155697034-8db41a71-e6e8-472a-bc7b-03d0cca3064a.mp4">
</video>

<script>
/* ============================================================
                       MUSIC FIX
============================================================ */
const bgMusic = document.getElementById("bgMusic");
document.addEventListener("click", () => { bgMusic.muted=false; bgMusic.play(); }, { once:true });

const clickSound = document.getElementById("clickSound");
const correctSound = document.getElementById("correctSound");

function playClick(){ clickSound.currentTime=0; clickSound.play(); }

/* ============================================================
                    DATA ITEM
============================================================ */
const itemData = {
    item1:{ place:"slot1", imgCorrect:"https://image2url.com/images/1764149866323-d242a6a1-476b-44e7-b3db-c7f7b7aba945.png" },
    item2:{ place:"slot2", imgCorrect:"https://image2url.com/images/1764150099026-659b9046-b832-4fdc-855c-076129fdce1f.png" },
    item3:{ place:"slot3", imgCorrect:"https://image2url.com/images/1764163237035-5e5690bd-0c00-473e-b8cd-f62771f81e8a.png"},
    item4:{ place:"slot4", imgCorrect:"https://image2url.com/images/1764150230736-7f97f280-60ea-41a4-b7f7-72d6e1683223.png" },
    item5:{ place:"slot5", imgCorrect:"https://image2url.com/images/1764150706211-ef7ca8b1-e88f-4eb7-ae5e-eca11207beda.png" }
};

const itemsOrder = ["item1","item2","item3","item4","item5"];
let currentHintIndex = 0;
const hand = document.getElementById("handHint");
let handAnimation = null;

/* ============================================================
                     DRAG SYSTEM
============================================================ */
let mopProgress = 500;         // berapa lama pel menyentuh kotoran
let mopNeeded = 1500;        // 1.5 detik
let mopLastTime = 0;

let selected=null, offsetX=0, offsetY=0;
let isMopPhase = false;
let pelItem = "item3";

document.querySelectorAll(".item").forEach(item=>{
    item.addEventListener("mousedown", e=>{
        if(isMopPhase && item.id !== pelItem) return;
        selected=e.target; playClick();
        offsetX=e.clientX-selected.getBoundingClientRect().left;
        offsetY=e.clientY-selected.getBoundingClientRect().top;
        selected.style.zIndex=10;
    });
});

document.addEventListener("mousemove", e=>{
    if(!selected) return;
    selected.style.left=(e.clientX-offsetX)+"px";
    selected.style.top=(e.clientY-offsetY)+"px";
});

document.addEventListener("mouseup", dragEnd);

/* ============================================================
                     HAND HINT
============================================================ */
function animateHandToSlot(itemId, slotId, repeat = 2) {
    if (handAnimation) handAnimation.cancel();

    hand.style.opacity = 1;
    let count = 0;

    function step() {
        const a = document.getElementById(itemId).getBoundingClientRect();
        const b = document.getElementById(slotId).getBoundingClientRect();

        hand.style.left = a.left + "px";
        hand.style.top = a.top + "px";

        handAnimation = hand.animate([
            { left: a.left + "px", top: a.top + "px" },
            { left: b.left + "px", top: b.top + "px" }
        ], { duration: 1500, easing: "ease-in-out", fill: "forwards" });

        handAnimation.onfinish = () => {
            count++;
            if (count < repeat) setTimeout(step, 300);
            else hand.style.opacity = 0;
        };
    }

    step();
}

function startHint(){
    if(currentHintIndex >= itemsOrder.length){
        hand.style.opacity = 0;
        return;
    }
    animateHandToSlot(itemsOrder[currentHintIndex], itemData[itemsOrder[currentHintIndex]].place);
}

startHint();

/* ============================================================
                 DRAG END — FIXED VERSION
============================================================ */
function dragEnd(){
    if(!selected) return;
    const id = selected.id;

    /* ----------------- FASE 2: MOP ----------------- */
    if(isMopPhase && id === "item3Draggable"){
    const dirtElements = document.querySelectorAll(".dirt");
    let anyOverlap = false;

    dirtElements.forEach(d => {
        const i = selected.getBoundingClientRect();
        const dRect = d.getBoundingClientRect();

        const overlap = i.left < dRect.right && i.right > dRect.left &&
                        i.top < dRect.bottom && i.bottom > dRect.top;

        if(overlap){
            anyOverlap = true;
            d.style.transition="opacity 2s ease";
            d.style.opacity=0;
            setTimeout(()=> d.style.display="none", 2000);
        }
    });

    // Jika semua kotoran sudah bersih, mainkan video
    const remaining = Array.from(document.querySelectorAll(".dirt")).some(d => d.style.display !== "none");
    if(!remaining){
        const video=document.getElementById("thankVideo");
        video.style.display="block";
        video.play();
    }

    selected=null;
    return;
}


    /* ----------------- FASE 1: SUSUN BARANG ----------------- */
    if(!itemData[id]){ selected=null; return; }

    const slotId=itemData[id].place;
    const slot=document.getElementById(slotId);

    const itemRect=selected.getBoundingClientRect();
    const slotRect=slot.getBoundingClientRect();

    const hit=itemRect.left<slotRect.right && itemRect.right>slotRect.left &&
              itemRect.top<slotRect.bottom && itemRect.bottom>slotRect.top;

    if(hit){
        selected.style.left = slot.style.left;
        selected.style.top = slot.style.top;
        selected.style.pointerEvents = "none";
        selected.src = itemData[id].imgCorrect;
        correctSound.play();

        const spark=document.createElement("div");
        spark.classList.add("sparkle");
        spark.style.left = slot.style.left;
        spark.style.top = slot.style.top;
        document.body.appendChild(spark);
        setTimeout(()=>spark.remove(),700);

        currentHintIndex++;
        startHint();
        checkAllPlaced();
    }

    selected=null;
}

/* ============================================================
                 CHECK ALL PLACED
============================================================ */
function checkAllPlaced(){
    const done = itemsOrder.every(id =>
        document.getElementById(id).style.pointerEvents==="none"
    );

    if(done){
        setTimeout(()=> startMopPhase(), 800);
    }
}

/* ============================================================
                START MOP PHASE — FIXED VERSION
============================================================ */
function startMopPhase(){
    isMopPhase = true;

    // Tampilkan semua kotoran
    document.querySelectorAll(".dirt").forEach(d => {
        d.style.display = "block";
        d.style.opacity = 1;
    });

    // buat item slot3 draggable (pel)
    const slot3 = document.getElementById("slot3");
    const rect = slot3.getBoundingClientRect();

    const item = document.createElement("img");
    item.id = "item3Draggable";
    item.src = itemData.item3.imgCorrect;
    item.classList.add("item");

    item.style.position="absolute";
    item.style.left = slot3.style.left;
    item.style.top  = slot3.style.top;

    item.style.width = "100px";
    item.style.height = "auto";

    document.body.appendChild(item);

    item.addEventListener("mousedown", e=>{
        selected = e.target;
        offsetX = e.clientX - selected.getBoundingClientRect().left;
        offsetY = e.clientY - selected.getBoundingClientRect().top;
        playClick();
    });
}


/* ============================================================
                    PANEL SETTING
============================================================ */
const overlay=document.getElementById("overlay");
const settingPanel=document.getElementById("settingPanel");
const closeSetting=document.getElementById("closeSetting");
const volumeSlider=document.getElementById("volumeSlider");
const muteInPanelImg=document.getElementById("muteInPanelImg");
const homeIcon=document.getElementById("homeIcon");
const settingBtn=document.getElementById("settingBtnImg");

settingBtn.addEventListener("click",()=>{ playClick(); settingPanel.classList.add("active"); overlay.classList.add("active"); });
closeSetting.addEventListener("click",()=>{ playClick(); settingPanel.classList.remove("active"); overlay.classList.remove("active"); });
overlay.addEventListener("click",()=>{ settingPanel.classList.remove("active"); overlay.classList.remove("active"); });

volumeSlider.addEventListener("input",()=>bgMusic.volume=volumeSlider.value);

muteInPanelImg.addEventListener("click",()=>{
    bgMusic.muted=!bgMusic.muted;
    muteInPanelImg.src = bgMusic.muted
        ? "https://image2url.com/images/1763955396010-0b7b0c78-8f9e-4cb0-8045-cd4dfd6acbd3.png"
        : "https://image2url.com/images/1763955187976-61e3ab1a-0b3b-47c3-8ab0-8f66ccfe1b72.png";
});

homeIcon.addEventListener("click", ()=>{ window.location.href="menu_page.html"; });

/* ============================================================
                    VIDEO END
============================================================ */


document.getElementById("thankVideo").addEventListener("ended",()=> {
    window.location.href="menu_pilihan.html";
});
</script>

</body>
</html>
